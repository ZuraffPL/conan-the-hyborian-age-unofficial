{{!-- Antagonist Actor Sheet --}}
<form class="{{cssClass}} flexcol" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-action="editImage" title="{{actor.name}}" alt="{{actor.name}}" />
    
    <div class="header-fields">
      <h1 class="charname">
        <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'CONAN.CharacterName'}}" />
      </h1>
      
      <div class="actor-type-row">
        <div class="actor-type-label">
          <span class="primary-label">{{localize "TYPES.Actor.antagonist"}}</span>
          <span class="subtitle-label">Antagonist</span>
        </div>
        
        <div class="creature-type-field">
          <label>
            <span class="primary-label">{{localize "CONAN.Common.type"}}</span>
            <span class="subtitle-label">Creature Type</span>
          </label>
          <select name="system.creatureType" data-dtype="String">
            <option value="human" {{#if (eq system.creatureType "human")}}selected{{/if}}>{{localize "CONAN.CreatureTypes.human"}} / Human</option>
            <option value="inanimate" {{#if (eq system.creatureType "inanimate")}}selected{{/if}}>{{localize "CONAN.CreatureTypes.inanimate"}} / Inanimate</option>
            <option value="undead" {{#if (eq system.creatureType "undead")}}selected{{/if}}>{{localize "CONAN.CreatureTypes.undead"}} / Undead</option>
            <option value="monstrosity" {{#if (eq system.creatureType "monstrosity")}}selected{{/if}}>{{localize "CONAN.CreatureTypes.monstrosity"}} / Monstrosity</option>
            <option value="demon" {{#if (eq system.creatureType "demon")}}selected{{/if}}>{{localize "CONAN.CreatureTypes.demon"}} / Demon</option>
            <option value="beast" {{#if (eq system.creatureType "beast")}}selected{{/if}}>{{localize "CONAN.CreatureTypes.beast"}} / Beast</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    {{!-- Tabs Navigation --}}
    <nav class="sheet-tabs tabs" data-group="primary">
      <a class="item" data-tab="stats">
        <i class="fas fa-chart-bar"></i> {{localize "CONAN.NPC.tabStats"}}
      </a>
      <a class="item" data-tab="powers">
        <i class="fas fa-magic"></i> {{localize "CONAN.NPC.tabPowers"}}
      </a>
    </nav>

    {{!-- Tab: Statistics --}}
    <div class="tab" data-group="primary" data-tab="stats">
      {{!-- Attributes Section --}}
      <div class="attributes-section">
      <h3 class="section-header">{{localize "CONAN.CharacterSheet.attributes"}} / Attributes</h3>
      
      <div class="attributes-row">
        {{#each system.attributes as |attr key|}}
        <div class="attribute-box" data-attribute="{{key}}">
          <div class="attribute-header">
            <span class="attribute-abbr">
              {{localize (concat "CONAN.Attributes." key ".abbr")}}
              {{#if (and @root.system.poisoned @root.system.poisonEffects.effect1)}}
                <i class="fas fa-skull-crossbones poison-skull-pulse" title="{{localize 'CONAN.Poisoned.attributePenalty'}}" style="color: #15a20e; margin-left: 4px; animation: pulse-poison 2s infinite;"></i>
              {{/if}}
            </span>
            <span class="attribute-label">{{localize (concat "CONAN.Attributes." key ".label")}}</span>
          </div>
          
          <div class="attribute-values">
            <div class="attribute-circle-wrapper">
              <input type="number" name="system.attributes.{{key}}.value" value="{{attr.value}}" min="1" max="50" data-dtype="Number" class="attribute-value {{#if (and @root.system.poisoned @root.system.poisonEffects.effect1)}}poisoned-attribute{{/if}}" />
              {{#if (and @root.system.poisoned @root.system.poisonEffects.effect1)}}
                <span class="poison-arrow-indicator" title="{{localize 'CONAN.Poisoned.attributePenalty'}}">â†“</span>
              {{/if}}
            </div>
            <select name="system.attributes.{{key}}.die" data-dtype="String" class="attribute-die">
              <option value="d4" {{#if (eq attr.die "d4")}}selected{{/if}}>d4</option>
              <option value="d6" {{#if (eq attr.die "d6")}}selected{{/if}}>d6</option>
              <option value="d8" {{#if (eq attr.die "d8")}}selected{{/if}}>d8</option>
              <option value="d10" {{#if (eq attr.die "d10")}}selected{{/if}}>d10</option>
              <option value="d12" {{#if (eq attr.die "d12")}}selected{{/if}}>d12</option>
            </select>
          </div>
          
          <button type="button" class="attribute-mod {{#if (and @root.system.poisoned @root.system.poisonEffects.effect2)}}poisoned-penalty{{/if}}" data-action="rollAttribute" data-attribute="{{key}}" title="{{localize 'CONAN.Common.roll'}}">
            <i class="fas fa-dice-d20"></i>
            {{localize 'CONAN.Common.roll'}}
            {{#if (and @root.system.poisoned @root.system.poisonEffects.effect2)}}
              <i class="fas fa-skull-crossbones poison-icon" title="{{localize 'CONAN.Poisoned.rollPenalty'}}" style="color: #15a20e; margin-left: 6px;"></i>
            {{/if}}
          </button>
        </div>
        {{/each}}
      </div>
      </div>

      {{!-- Defense and Life Points Section --}}
      <div class="defense-section antagonist-defense">
        <h3 class="section-header">{{localize "CONAN.NPC.defenseLifePoints"}} / Defences & Life Points</h3>
      
      <div class="defense-row">
        <div class="defense-box">
          <div class="defense-header">
            <span class="defense-abbr">{{localize "CONAN.Resources.physical"}}</span>
            <span class="defense-label">Physical Defence</span>
          </div>
          
          <div class="defense-value-container {{#if system.defenceActive}}defence-active{{/if}} {{#if system.immobilized}}immobilized-active{{/if}}">
            <input type="number" name="system.defense.physical" value="{{system.defense.physical}}" min="0" max="50" data-dtype="Number" class="defense-value {{#if system.immobilized}}immobilized{{/if}}" />
            <div class="defense-indicators">
              {{#if system.defenceActive}}
                <span class="defence-bonus">+2</span>
              {{/if}}
              {{#if system.immobilized}}
                <span class="immobilized-indicator">0</span>
              {{/if}}
            </div>
          </div>
        </div>

        <div class="defense-box">
          <div class="defense-header">
            <span class="defense-abbr">{{localize "CONAN.Resources.sorcery"}}</span>
            <span class="defense-label">Sorcery Defence</span>
          </div>
          
          <input type="number" name="system.defense.sorcery" value="{{system.defense.sorcery}}" min="0" max="50" data-dtype="Number" class="defense-value" />
        </div>

        <div class="defense-box">
          <div class="defense-header">
            <span class="defense-abbr">{{localize "CONAN.NPC.armor"}}</span>
            <span class="defense-label">Armor ({{localize "CONAN.NPC.armorAbbr"}})</span>
          </div>
          
          <input type="number" name="system.armor" value="{{system.armor}}" min="0" max="20" data-dtype="Number" class="defense-value" />
        </div>

        <div class="defense-box {{#if (and system.poisoned system.poisonEffects.effect3)}}poison-life-drain-active{{/if}}">
          <div class="defense-header">
            <span class="defense-abbr">{{localize "CONAN.NPC.lifePoints"}}</span>
            <span class="defense-label">
              Life Points
              {{#if (and system.poisoned system.poisonEffects.effect3)}}
                <i class="fas fa-skull-crossbones poison-life-drain-icon" title="{{localize 'CONAN.Poisoned.option3.name'}}"></i>
              {{/if}}
            </span>
          </div>
          
          <div style="display:flex; align-items:center; gap:4px; justify-content:center;">
            <input type="number" name="system.lifePoints.value" value="{{system.lifePoints.value}}" min="0" max="9999" data-dtype="Number" class="defense-value" style="width:50px;" title="{{localize 'CONAN.Resources.actual'}}" />
            <span style="color:#8b4513; font-weight:bold;">/</span>
            <input type="number" name="system.lifePoints.max" value="{{system.lifePoints.max}}" min="0" max="9999" data-dtype="Number" class="defense-value" style="width:50px;" title="{{localize 'CONAN.Resources.max'}}" />
          </div>
        </div>
      </div>
      </div>

      {{!-- Damage and Actions Section --}}
      <div class="damage-actions-container">
        {{!-- Damage Section --}}
        <div class="damage-section">
          <h3 class="section-header">{{localize "CONAN.NPC.damage"}} / Damage</h3>
        
        {{!-- Melee Damage --}}
        <div class="damage-row">
          <div class="damage-row-header">
            <span class="primary-label">{{localize "CONAN.NPC.meleeDamage"}}</span>
            <span class="subtitle-label">Melee DMG</span>
            <button type="button" class="npc-attack-btn {{#if (and system.poisoned system.poisonEffects.effect2)}}poisoned-penalty{{/if}}" data-action="npcAttack" data-attack-type="melee" title="{{localize 'CONAN.Attack.rollAttack'}}">
              <i class="fas fa-sword"></i>
              {{#if (and system.poisoned system.poisonEffects.effect2)}}
                <i class="fas fa-skull-crossbones poison-icon" style="color: #15a20e; font-size: 0.8em; margin-left: 4px;"></i>
              {{/if}}
            </button>
            <button type="button" class="npc-damage-btn {{#if (and system.poisoned system.poisonEffects.effect2)}}poisoned-penalty{{/if}}" data-action="npcDamage" data-attack-type="melee" title="{{localize 'CONAN.Damage.rollDamage'}}">
              <img src="systems/conan-the-hyborian-age/assets/icons/damage.svg" alt="{{localize 'CONAN.Damage.rollDamage'}}" />
              {{#if (and system.poisoned system.poisonEffects.effect2)}}
                <i class="fas fa-skull-crossbones poison-icon" style="color: #15a20e; font-size: 0.8em; margin-left: 4px;"></i>
              {{/if}}
            </button>
          </div>
          
          <div class="damage-fields">
            <input type="text" name="system.damage.melee.name" value="{{system.damage.melee.name}}" placeholder="{{localize 'CONAN.NPC.weaponName'}}" class="damage-name" {{#if system.damage.melee.notApplicable}}disabled{{/if}} />
            
            <select name="system.damage.melee.die" data-dtype="String" class="damage-die" {{#if system.damage.melee.notApplicable}}disabled{{/if}}>
              <option value="d4" {{#if (eq system.damage.melee.die "d4")}}selected{{/if}}>d4</option>
              <option value="d6" {{#if (eq system.damage.melee.die "d6")}}selected{{/if}}>d6</option>
              <option value="d8" {{#if (eq system.damage.melee.die "d8")}}selected{{/if}}>d8</option>
              <option value="d10" {{#if (eq system.damage.melee.die "d10")}}selected{{/if}}>d10</option>
              <option value="d12" {{#if (eq system.damage.melee.die "d12")}}selected{{/if}}>d12</option>
            </select>
            
            <input type="number" name="system.damage.melee.modifier" value="{{system.damage.melee.modifier}}" min="0" max="15" data-dtype="Number" class="damage-modifier" {{#if system.damage.melee.notApplicable}}disabled{{/if}} />
            
            <label class="damage-na">
              <input type="checkbox" name="system.damage.melee.notApplicable" {{#if system.damage.melee.notApplicable}}checked{{/if}} data-dtype="Boolean" />
              <span>{{localize "CONAN.NPC.notApplicable"}}</span>
            </label>
          </div>
        </div>
        
        {{!-- Ranged Damage --}}
        <div class="damage-row">
          <div class="damage-row-header">
            <span class="primary-label">{{localize "CONAN.NPC.rangedDamage"}}</span>
            <span class="subtitle-label">Ranged DMG</span>
            <button type="button" class="npc-attack-btn {{#if (and system.poisoned system.poisonEffects.effect2)}}poisoned-penalty{{/if}}" data-action="npcAttack" data-attack-type="ranged" title="{{localize 'CONAN.Attack.rollAttack'}}">
              <i class="fas fa-sword"></i>
              {{#if (and system.poisoned system.poisonEffects.effect2)}}
                <i class="fas fa-skull-crossbones poison-icon" style="color: #15a20e; font-size: 0.8em; margin-left: 4px;"></i>
              {{/if}}
            </button>
            <button type="button" class="npc-damage-btn {{#if (and system.poisoned system.poisonEffects.effect2)}}poisoned-penalty{{/if}}" data-action="npcDamage" data-attack-type="ranged" title="{{localize 'CONAN.Damage.rollDamage'}}">
              <img src="systems/conan-the-hyborian-age/assets/icons/damage.svg" alt="{{localize 'CONAN.Damage.rollDamage'}}" />
              {{#if (and system.poisoned system.poisonEffects.effect2)}}
                <i class="fas fa-skull-crossbones poison-icon" style="color: #15a20e; font-size: 0.8em; margin-left: 4px;"></i>
              {{/if}}
            </button>
          </div>
          
          <div class="damage-fields">
            <input type="text" name="system.damage.ranged.name" value="{{system.damage.ranged.name}}" placeholder="{{localize 'CONAN.NPC.weaponName'}}" class="damage-name" {{#if system.damage.ranged.notApplicable}}disabled{{/if}} />
            
            <select name="system.damage.ranged.die" data-dtype="String" class="damage-die" {{#if system.damage.ranged.notApplicable}}disabled{{/if}}>
              <option value="d4" {{#if (eq system.damage.ranged.die "d4")}}selected{{/if}}>d4</option>
              <option value="d6" {{#if (eq system.damage.ranged.die "d6")}}selected{{/if}}>d6</option>
              <option value="d8" {{#if (eq system.damage.ranged.die "d8")}}selected{{/if}}>d8</option>
              <option value="d10" {{#if (eq system.damage.ranged.die "d10")}}selected{{/if}}>d10</option>
              <option value="d12" {{#if (eq system.damage.ranged.die "d12")}}selected{{/if}}>d12</option>
            </select>
            
            <input type="number" name="system.damage.ranged.modifier" value="{{system.damage.ranged.modifier}}" min="0" max="15" data-dtype="Number" class="damage-modifier" {{#if system.damage.ranged.notApplicable}}disabled{{/if}} />
            
            <label class="damage-na">
              <input type="checkbox" name="system.damage.ranged.notApplicable" {{#if system.damage.ranged.notApplicable}}checked{{/if}} data-dtype="Boolean" />
              <span>{{localize "CONAN.NPC.notApplicable"}}</span>
            </label>
          </div>
        </div>
        </div>
      
        {{!-- Right Column: Actions + Effects --}}
        <div class="right-column">
          {{!-- Actions Section --}}
          <div class="actions-section">
            <h3 class="section-header">{{localize "CONAN.NPC.actions"}} / Actions & Attacks</h3>
          
          <div class="action-field">
            <label>
              <span class="primary-label">{{localize "CONAN.NPC.actionsPerRound"}}</span>
              <span class="subtitle-label">Actions per Round</span>
            </label>
            <input type="number" name="system.actions.perRound" value="{{system.actions.perRound}}" min="1" max="10" data-dtype="Number" class="action-value" />
          </div>
          
          <div class="action-field">
            <label>
              <span class="primary-label">{{localize "CONAN.NPC.attacksPerRound"}}</span>
              <span class="subtitle-label">Attacks per Round</span>
            </label>
            <input type="number" name="system.actions.attacks" value="{{system.actions.attacks}}" min="1" max="10" data-dtype="Number" class="action-value" />
          </div>
          </div>
          
          {{!-- Effects Section --}}
          <div class="effects-section">
            <h3 class="section-header">{{localize "CONAN.NPC.effects"}} / Effects</h3>
            
            <div class="effects-row">
              <button type="button" class="defence-toggle-btn {{#if system.defenceActive}}active{{/if}}" data-action="toggleDefence" title="{{localize 'CONAN.EffectTooltips.defence'}}">
                <i class="fas fa-shield-alt"></i>
              </button>
              
              <button type="button" class="immobilized-toggle-btn {{#if system.immobilized}}active{{/if}}" data-action="toggleImmobilized" title="{{localize 'CONAN.EffectTooltips.immobilized'}}">
                <img src="systems/conan-the-hyborian-age/assets/icons/paralysis.svg" alt="Immobilized" />
              </button>
              
              <div style="position: relative; display: inline-block;">
                {{#if (and system.poisoned (gt activePoisonEffects 0))}}
                  <span class="poison-effect-count">{{activePoisonEffects}}</span>
                {{/if}}
                {{#if (and system.poisoned system.poisonEffects.effect2 (gt system.poisonEffects.effect2Multiplier 1))}}
                  <span class="poison-multiplier effect2">x{{system.poisonEffects.effect2Multiplier}}</span>
                {{/if}}
                {{#if (and system.poisoned system.poisonEffects.effect3 (gt system.poisonEffects.effect3Multiplier 1))}}
                  <span class="poison-multiplier effect3">x{{system.poisonEffects.effect3Multiplier}}</span>
                {{/if}}
                <button type="button" class="poisoned-toggle-btn {{#if system.poisoned}}active{{/if}}" data-action="togglePoisoned" title="{{localize 'CONAN.EffectTooltips.poisoned'}}">
                  <img src="systems/conan-the-hyborian-age/assets/icons/Poisoned.svg" alt="Poisoned" />
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {{!-- End Tab: Statistics --}}

    {{!-- Tab: Powers and Special Rules --}}
    <div class="tab" data-group="primary" data-tab="powers">
      <h3 class="section-header">{{localize "CONAN.NPC.powersAndRules"}} / Powers & Special Rules</h3>
      
      <div class="powers-section">
        <div class="powers-subsection">
          <h4 class="subsection-header">
            <i class="fas fa-magic"></i> {{localize "CONAN.NPC.magicPowers"}} / Magic Powers
          </h4>
          <textarea name="system.powers.magic" rows="5" class="auto-resize-powers" placeholder="{{localize 'CONAN.NPC.magicPowersPlaceholder'}}">{{system.powers.magic}}</textarea>
        </div>
        
        <div class="powers-separator"></div>
        
        <div class="powers-subsection">
          <h4 class="subsection-header">
            <i class="fas fa-bolt"></i> {{localize "CONAN.NPC.specialActions"}} / Special Actions
          </h4>
          <textarea name="system.powers.special" rows="5" class="auto-resize-powers" placeholder="{{localize 'CONAN.NPC.specialActionsPlaceholder'}}">{{system.powers.special}}</textarea>
        </div>
      </div>
    </div>
    {{!-- End Tab: Powers --}}
  </section>
</form>

